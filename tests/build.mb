sector config
  section files
    ; Directories
    str build_root 'build/'
    str debug_dir '$(/config/files/build_root)debug/'
    str release_dir '$(/config/files/build_root)release/'
    str obj_dir 'obj/'

    ; Binaries
    str binname 'mfdasm'

    ; Source Info
    str unit_tests_src 'unit/'
    list str unit_tests
          'test'
    list str includes '.', '3rdparty/doctest'
  end

  section tools
    str cc 'clang++'
    str cflags '-fno-exceptions -std=c++20 -stdlib=libc++ -Wall -Wextra -I$(/config/files/includes)'

    str ldflags '-stdlib=libc++'
  end

  section mariebuild
    u8 default_log_level 2

    list str targets 'tests', 'format'
    str default 'tests'
  end
end

sector targets
  section build
    list str c_rules 'unit_compile'

    str target_objdir 'build/'
  end

  section run
    list str c_rules 'unit_run'
  end

  section tests
    list str required_targets 'build', 'run'
  end
end

sector c_rules
  section unit_compile
    str exec_mode 'singular'
    bool parallel true
    u8 max_procs 3

    str input_src '/config/files/unit_tests'

    str input_format '$(/config/files/unit_tests_src)$(%element%).cpp'
    str output_format '$(/config/files/obj_dir)unit_$(%element%)'

    str exec '#!/bin/bash
              mkdir -p \$(dirname $(%output%))
              COMMAND="$(/config/tools/cc) $(/config/tools/cflags) -o $(%output%) $(%input%)"
              echo "  $COMMAND"
              $COMMAND
    '
  end

  section unit_run
    str exec_mode 'singular'
    bool parallel false

    str input_src '/config/files/unit_tests'
    str input_format '$(/config/files/obj_dir)unit_$(%element%)'
    str output_format ''

    str exec '$(%input%)'
  end
end